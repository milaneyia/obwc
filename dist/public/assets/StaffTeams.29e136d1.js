import{C as e}from"./index.ffdc3ce4.js";import{_ as t}from"./DataTable.db84bfbd.js";import{d as s,o as a,c as n,a as i,n as m,D as r,F as o,r as l,e as d,t as c,f as u,E as p,b as f,w as h}from"./vendor.0a1e94ee.js";var b=s({name:"StaffTeamUpdate",props:{teamProp:{type:Object,default:()=>null}},emits:["update:team","remove:team"],data:()=>({name:"",users:[]}),watch:{teamProp(e){this.name=(null==e?void 0:e.name)||"",this.users=(null==e?void 0:e.users)||[]}},methods:{async update(){const{data:e}=await this.$http.put(`/api/staff/teams/${this.teamProp.id}`,{name:this.name});this.$emit("update:team",e),this.name=e.name},async removeUser(e){if(!confirm("Remove user from the team?"))return;const{data:t}=await this.$http.put(`/api/staff/teams/${this.teamProp.id}/removeUser`,{userId:e});this.$emit("update:team",t),this.users=t.users},async transferOwnership(e){const{data:t}=await this.$http.put(`/api/staff/teams/${this.teamProp.id}/transferOwnership`,{userId:e});this.$emit("update:team",t),this.users=t.users},async removeTeam(){confirm("This will delete all team related data (name, users, invitations), are you sure?")&&(await this.$http.delete(`/api/staff/teams/${this.teamProp.id}`),this.$emit("remove:team",this.teamProp.id))}}});const v={class:"modal fade",tabindex:"-1"},y={class:"modal-dialog modal-xl"},k={class:"modal-content"},$=i("div",{class:"modal-header"},[i("h5",{class:"modal-title"}," Update team "),i("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),g={key:0,class:"modal-body"},w={class:"container"},C={class:"row mb-2"},T={class:"col-sm"},U=i("hr",null,null,-1),x={class:"row"},L=i("hr",null,null,-1),I={class:"row"},P={class:"col-sm"};b.render=function(e,t,s,p,f,h){return a(),n("div",v,[i("div",y,[i("div",k,[$,e.teamProp?(a(),n("div",g,[i("div",w,[i("div",C,[i("div",T,[m(i("input",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.name=t),type:"text",class:"form-control",placeholder:"Name..."},null,512),[[r,e.name]]),i("button",{class:"btn btn-sm btn-primary mt-2",onClick:t[2]||(t[2]=(...t)=>e.update&&e.update(...t))}," Update name ")])]),U,i("div",x,[(a(!0),n(o,null,l(e.users,(t=>(a(),n("div",{key:t.id,class:"col-sm-12"},[d(c(t.username)+" ",1),i("button",{class:"btn btn-sm btn-danger me-2 mb-2",onClick:s=>e.removeUser(t.id)}," Remove ",8,["onClick"]),i("button",{class:"btn btn-sm btn-danger me-2 mb-2",onClick:s=>e.transferOwnership(t.id)}," Transfer Captain Role ",8,["onClick"])])))),128))]),L,i("div",I,[i("div",P,[i("button",{class:"btn btn-sm btn-danger",onClick:t[3]||(t[3]=(...t)=>e.removeTeam&&e.removeTeam(...t))}," Delete everything ")])])])])):u("",!0)])])])};var j=s({props:{users:{type:Array,required:!0}},setup:e=>()=>e.users.map(((t,s)=>p("span",[p("a",{href:`https://osu.ppy.sh/users/${t.osuId}`,target:"_blank"},t.username),s<e.users.length-1?", ":void 0])))}),D=s({components:{DataTable:t,StaffTeamUpdate:b,UsersLinks:j},data:()=>({teams:[],selectedTeam:null,fields:[{key:"country",label:"Country",formatter:e=>e.name},{key:"name",label:"Name"},{key:"captain",label:"Captain",formatter:e=>e.username},{key:"users",label:"Accepted Users"},{key:"invitations",label:"Invited Users"}],generatedTeamList:""}),async created(){const{data:t}=await this.$http.get(`/api/staff/contests/${this.$route.params.id||e.Standard}/teams`);this.teams=t},methods:{async confirm(e){await this.$http.put(`/api/staff/teams/${e}/confirm`);const t=this.teams.findIndex((t=>t.id===e));-1!==t&&(this.teams[t].wasConfirmed=!0)},async deny(e){await this.$http.put(`/api/staff/teams/${e}/deny`);const t=this.teams.findIndex((t=>t.id===e));-1!==t&&(this.teams[t].wasConfirmed=!1)},update(e){const t=this.teams.findIndex((t=>t.id===e.id));-1!==t&&(this.teams[t]=e)},remove(e){const t=this.teams.findIndex((t=>t.id===e));-1!==t&&this.teams.splice(t,1)},generateTeamList(e){if(this.generatedTeamList&&!confirm("this will reset the view"))return;let t=e?this.teams.filter((e=>e.wasConfirmed)):this.teams;this.generatedTeamList="|  | Country | Name | Members |\n| :-: | :-: | :-: | :-- |\n",this.generatedTeamList+=t.map((e=>`| ![][flag_${e.country.code}] | **${e.country.name}** | **${e.name}** | **[${e.captain.username}](https://osu.ppy.sh/users/${e.captain.osuId})**, ${e.users.map((e=>`[${e.username}](https://osu.ppy.sh/users/${e.osuId})`)).join(", ")} |\n`))}}});const O={class:"container"},R={class:"row mb-2"},_={class:"col-sm"},N={class:"row"},S={class:"col-sm"};D.render=function(e,t,s,o,l,d){const c=f("users-links"),p=f("data-table"),b=f("staff-team-update");return a(),n("div",O,[i("div",R,[i("div",_,[i("button",{class:"btn btn-sm btn-info me-2",onClick:t[1]||(t[1]=t=>e.generateTeamList(!1))}," generate list "),i("button",{class:"btn btn-sm btn-info",onClick:t[2]||(t[2]=t=>e.generateTeamList(!0))}," generate list (only confirmed) "),e.generatedTeamList?m((a(),n("textarea",{key:0,"onUpdate:modelValue":t[3]||(t[3]=t=>e.generatedTeamList=t),class:"my-4 bg-white text-dark form-control form-control-sm fs-xs",rows:"10"},null,512)),[[r,e.generatedTeamList,void 0,{trim:!0}]]):u("",!0)])]),i("div",N,[i("div",S,[i(p,{items:e.teams,fields:e.fields},{"cell-users":h((({value:e})=>[i(c,{users:e},null,8,["users"])])),"cell-invitations":h((({value:e})=>[i(c,{users:e},null,8,["users"])])),actions:h((({item:t})=>[i("button",{class:"btn btn-sm btn-primary me-2","data-bs-toggle":"modal","data-bs-target":"#teamUpdate",onClick:s=>e.selectedTeam=t}," Edit ",8,["onClick"]),t.wasConfirmed?(a(),n("button",{key:1,class:"btn btn-sm btn-danger",onClick:s=>e.deny(t.id)}," Deny ",8,["onClick"])):(a(),n("button",{key:0,class:"btn btn-sm btn-success",onClick:s=>e.confirm(t.id)}," Confirm ",8,["onClick"]))])),_:1},8,["items","fields"])])]),i(b,{id:"teamUpdate","team-prop":e.selectedTeam,"onUpdate:team":t[4]||(t[4]=t=>e.update(t)),"onRemove:team":t[5]||(t[5]=t=>e.remove(t))},null,8,["team-prop"])])};export default D;
