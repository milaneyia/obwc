var e=Object.defineProperty,i=Object.defineProperties,n=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,o=(i,n,t)=>n in i?e(i,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[n]=t;import{d as a,o as d,c as g,n as l,D as u,a as c,t as m,g as b,e as h,m as j,b as p,B as f,r as v,w}from"./vendor.0a1e94ee.js";import{S as J,c as y,d as C,I as S}from"./index.ffdc3ce4.js";import{_ as T}from"./DataTable.db84bfbd.js";var x=a({name:"JudgingScoring",computed:{originalJudging(){return this.$store.state.judging.originalJudging},criteria(){var e,i;return null==(i=null==(e=this.originalJudging)?void 0:e.judgingToCriteria)?void 0:i.criteria},submission(){var e,i;return null==(i=null==(e=this.originalJudging)?void 0:e.judging)?void 0:i.submission},newGeneralComment:{get(){var e;return null==(e=this.$store.state.judging.newJudging)?void 0:e.judging.comment},set(e){const i=this.cloneNewJudging();i.judging.comment=e,this.$store.commit("judging/"+J,i)}},newComment:{get(){var e;return null==(e=this.$store.state.judging.newJudging)?void 0:e.judgingToCriteria.comment},set(e){const i=this.cloneNewJudging();i.judgingToCriteria.comment=e,this.$store.commit("judging/"+J,i)}},newScore:{get(){var e;return null==(e=this.$store.state.judging.newJudging)?void 0:e.judgingToCriteria.score},set(e){const i=this.cloneNewJudging();i.judgingToCriteria.score=e,this.$store.commit("judging/"+J,i)}}},methods:{async save(){await this.$store.dispatch("judging/"+y)},cloneNewJudging(){return JSON.parse(JSON.stringify(this.$store.state.judging.newJudging))}}});const k={key:0,class:"judging-scoring"},$=c("hr",null,null,-1),O={class:"card bg-dark"},N={class:"card-header"},D=h(" Editing "),I=h(" for "),P={class:"card-body"},E={class:"form-group"},A=c("label",{for:"score"},"Score",-1),G={class:"form-group"},R=c("label",{for:"comment"}," Comment ",-1),U={class:"card-footer"},V={key:1,class:"text-muted"};x.render=function(e,i,n,t,r,s){return e.originalJudging&&e.criteria&&e.submission?(d(),g("div",k,[l(c("textarea",{id:"comment","onUpdate:modelValue":i[1]||(i[1]=i=>e.newGeneralComment=i),maxlength:3e3,rows:5,class:"form-control",placeholder:"General comment"},null,512),[[u,e.newGeneralComment]]),$,c("div",O,[c("div",N,[D,c("b",null,m(e.criteria.name),1),I,c("b",null,m(e.submission.anonymisedAs),1)]),c("div",P,[c("div",E,[A,l(c("input",{id:"score","onUpdate:modelValue":i[2]||(i[2]=i=>e.newScore=i),type:"number",step:"1",min:"1",max:e.criteria.maxScore,class:"form-control"},null,8,["max"]),[[u,e.newScore]])]),c("div",G,[R,l(c("textarea",{id:"comment","onUpdate:modelValue":i[3]||(i[3]=i=>e.newComment=i),maxlength:3e3,rows:5,class:"form-control",placeholder:"Criteria specific"},null,512),[[u,e.newComment]])])]),c("div",U,[c("button",{type:"button",class:"btn btn-primary",onClick:i[4]||(i[4]=b((i=>e.save()),["prevent"]))}," Save changes ")])])])):(d(),g("div",V," Select a score to begin... "))};var F,_,B=a({name:"JudgingTable",components:{DataTable:T},computed:(F=((e,i)=>{for(var n in i||(i={}))r.call(i,n)&&o(e,n,i[n]);if(t)for(var n of t(i))s.call(i,n)&&o(e,n,i[n]);return e})({},j({round:e=>e.judging.currentRound,criterias:e=>e.judging.criterias,judgingDone:e=>e.judging.judgingDone,originalJudging:e=>e.judging.originalJudging,newJudging:e=>e.judging.newJudging})),_={fields(){const e=[{key:"anonymisedAs",label:"Entry's Name",sortable:!0}];return e.push(...this.criterias.map((e=>({key:"criteria-"+e.id,label:e.name,sortable:!0}))),{key:"total",label:"Total",sortable:!0},{key:"completed",label:"Completed",sortable:!0}),e},items(){return this.round.submissions.map((e=>{const i={id:e.id,anonymisedAs:e.anonymisedAs,total:this.getTotalScore(e.id),completed:this.isCompleted(e.id)};for(const n of this.criterias)i["criteria-"+n.id]=this.getScore(e.id,n.id);return i}))},maxPossibleScore(){return this.criterias.reduce(((e,i)=>i.maxScore+e),0)}},i(F,n(_))),methods:{getSlotName:e=>"cell-criteria-"+e,getScore(e,i){const n=this.$store.getters["judging/getJudgingToCriterias"]({submissionId:e,criteriaId:i});return n?n.score:0},getTotalScore(e){const i=this.judgingDone.find((i=>i.submissionId===e));return i?i.judgingToCriterias.reduce(((e,i)=>i.score+e),0):0},isCompleted(e){const i=this.judgingDone.find((i=>i.submissionId===e));return!!i&&i.judgingToCriterias.length===this.criterias.length},selectForEditing(e,i){var n,t,r,s,o,a;(!this.originalJudging||!this.newJudging||(null==(n=this.originalJudging)?void 0:n.judgingToCriteria.comment)===(null==(t=this.newJudging)?void 0:t.judgingToCriteria.comment)&&(null==(r=this.originalJudging)?void 0:r.judgingToCriteria.score)===(null==(s=this.newJudging)?void 0:s.judgingToCriteria.score)&&(null==(o=this.originalJudging)?void 0:o.judging.comment)===(null==(a=this.newJudging)?void 0:a.judging.comment)||confirm("Changes may be lost, are you sure?"))&&this.$store.dispatch("judging/"+C,{submission:this.round.submissions.find((i=>i.id===e)),criteria:i})}}});const q=c("i",{class:"me-1 fas fa-edit"},null,-1);B.render=function(e,i,n,t,r,s){const o=p("data-table");return d(),g(o,{"custom-class":"table-bordered table-sm",fields:e.fields,items:e.items},f({"cell-total":w((({value:i})=>[h(m(i)+" / "+m(e.maxPossibleScore),1)])),"cell-completed":w((({value:e})=>[c("i",{class:["fa",e?"fa-check text-success":"fa-times text-danger"]},null,2)])),_:2},[v(e.criterias,(i=>({name:e.getSlotName(i.id),fn:w((({item:n,value:t})=>[c("a",{href:"#",class:"d-flex align-items-center justify-content-center",onClick:b((t=>e.selectForEditing(n.id,i)),["prevent"])},[q,h(" "+m(t)+" / "+m(i.maxScore),1)],8,["onClick"])]))})))]),1032,["fields","items"])};var z=a({components:{JudgingTable:B,JudgingScoring:x},computed:j({user:e=>e.loggedInUser,currentRound:e=>e.judging.currentRound}),async created(){await this.$store.dispatch("judging/"+S)}});const H={class:"container-fluid"},K={key:0,class:"row"},L={class:"col-lg-8"},M={class:"col-lg-4"},Q={key:1};z.render=function(e,i,n,t,r,s){const o=p("judging-table"),a=p("judging-scoring");return d(),g("div",H,[e.currentRound?(d(),g("div",K,[c("div",L,[c(o)]),c("div",M,[c(a)])])):(d(),g("div",Q," Judging hasn't started or just ended or i fucked up, ops "))])};export default z;
